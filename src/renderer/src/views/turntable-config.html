<template>
    <import from="../components/app-layout"></import>
    <import from="../components/nav-bar"></import>

    <app-layout title="EX-Turntable Configuration">
        <div class="max-w-3xl mx-auto space-y-6">
            <!-- Tabs -->
            <div class="flex border-b">
                <button repeat.for="tab of tabs" click.trigger="activeTab = tab"
                    class="px-4 py-2 text-sm font-medium border-b-2 transition-colors
                           ${activeTab === tab ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700'}">
                    ${tab}
                </button>
            </div>

            <!-- General Tab -->
            <div show.bind="activeTab === 'General'" class="space-y-4">
                <!-- I2C Address -->
                <div class="border rounded-lg p-4 space-y-3">
                    <h3 class="font-semibold text-gray-800">I2C Address</h3>
                    <div class="flex items-center gap-3">
                        <button click.trigger="decrementAddress()" class="e-btn e-small e-outline">-</button>
                        <input type="text" value.bind="i2cAddressHex" readonly
                            class="w-20 text-center px-3 py-2 border rounded font-mono" />
                        <button click.trigger="incrementAddress()" class="e-btn e-small e-outline">+</button>
                        <span class="text-sm text-gray-500">(Range: 0x08 – 0x77)</span>
                    </div>
                </div>

                <!-- Mode -->
                <div class="border rounded-lg p-4 space-y-3">
                    <h3 class="font-semibold text-gray-800">Mode</h3>
                    <div class="flex items-center gap-4">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="mode" model.bind="'TURNTABLE'" checked.bind="mode" />
                            <span>Turntable</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="mode" model.bind="'TRAVERSER'" checked.bind="mode" />
                            <span>Traverser</span>
                        </label>
                    </div>
                </div>

                <!-- Phase Switching -->
                <div class="border rounded-lg p-4 space-y-3">
                    <h3 class="font-semibold text-gray-800">Phase Switching</h3>
                    <div class="flex items-center gap-4">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="phase" model.bind="'AUTO'" checked.bind="phaseSwitching" />
                            <span>Auto</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="radio" name="phase" model.bind="'MANUAL'" checked.bind="phaseSwitching" />
                            <span>Manual</span>
                        </label>
                    </div>
                    <div show.bind="phaseSwitching === 'AUTO'" class="flex items-center gap-3 mt-2">
                        <label class="text-sm">Phase switch angle (0–180):</label>
                        <input type="number" min="0" max="180" value.bind="phaseSwitchAngle"
                            class="w-20 px-3 py-2 border rounded" />
                    </div>
                </div>

                <!-- Sensors -->
                <div class="border rounded-lg p-4 space-y-3">
                    <h3 class="font-semibold text-gray-800">Sensor Settings</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm font-medium">Home sensor active state</label>
                            <select value.bind="homeSensorActiveState" class="mt-1 w-full px-3 py-2 border rounded">
                                <option value="LOW">LOW (active low)</option>
                                <option value="HIGH">HIGH (active high)</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-sm font-medium">Limit sensor active state</label>
                            <select value.bind="limitSensorActiveState" class="mt-1 w-full px-3 py-2 border rounded">
                                <option value="LOW">LOW (active low)</option>
                                <option value="HIGH">HIGH (active high)</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-sm font-medium">Relay active state</label>
                            <select value.bind="relayActiveState" class="mt-1 w-full px-3 py-2 border rounded">
                                <option value="HIGH">HIGH (active high)</option>
                                <option value="LOW">LOW (active low)</option>
                            </select>
                        </div>
                    </div>
                    <label class="flex items-center gap-3 cursor-pointer mt-2">
                        <input type="checkbox" checked.bind="sensorTesting" class="w-4 h-4 text-blue-600 rounded" />
                        <span>Enable sensor testing mode</span>
                    </label>
                </div>
            </div>

            <!-- Stepper Options Tab -->
            <div show.bind="activeTab === 'Stepper Options'" class="space-y-4">
                <div class="border rounded-lg p-4 space-y-3">
                    <h3 class="font-semibold text-gray-800">Stepper Driver</h3>
                    <select value.bind="stepperDriver" class="w-full px-3 py-2 border rounded">
                        <option value="">Select stepper driver</option>
                        <option repeat.for="s of stepperDrivers" value.bind="s">${s}</option>
                    </select>
                </div>

                <div class="border rounded-lg p-4 space-y-3">
                    <h3 class="font-semibold text-gray-800">Speed &amp; Acceleration</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm font-medium">Max speed (10–20000)</label>
                            <input type="number" min="10" max="20000" value.bind="maxSpeed"
                                class="mt-1 w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                            <label class="text-sm font-medium">Acceleration (1–1000)</label>
                            <input type="number" min="1" max="1000" value.bind="acceleration"
                                class="mt-1 w-full px-3 py-2 border rounded" />
                        </div>
                    </div>
                </div>

                <div class="border rounded-lg p-4 space-y-3">
                    <h3 class="font-semibold text-gray-800">Additional Options</h3>
                    <div class="flex items-center gap-3">
                        <label class="text-sm font-medium">Gearing factor (1–10):</label>
                        <input type="number" min="1" max="10" value.bind="gearingFactor"
                            class="w-20 px-3 py-2 border rounded" />
                    </div>
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" checked.bind="disableOutputsIdle"
                            class="w-4 h-4 text-blue-600 rounded" />
                        <span>Disable outputs when idle</span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" checked.bind="invertDirection" class="w-4 h-4 text-blue-600 rounded" />
                        <span>Invert direction pin</span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" checked.bind="invertStep" class="w-4 h-4 text-blue-600 rounded" />
                        <span>Invert step pin</span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" checked.bind="invertEnable" class="w-4 h-4 text-blue-600 rounded" />
                        <span>Invert enable pin</span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" checked.bind="forwardOnly" class="w-4 h-4 text-blue-600 rounded" />
                        <span>Forward rotation only</span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" checked.bind="reverseOnly" class="w-4 h-4 text-blue-600 rounded" />
                        <span>Reverse rotation only</span>
                    </label>
                </div>
            </div>

            <!-- Advanced Tab -->
            <div show.bind="activeTab === 'Advanced'" class="space-y-4">
                <div class="border rounded-lg p-4 space-y-3">
                    <h3 class="font-semibold text-gray-800">Advanced Settings</h3>
                    <label class="flex items-center gap-3 cursor-pointer">
                        <input type="checkbox" checked.bind="enableDebug" class="w-4 h-4 text-blue-600 rounded" />
                        <span>Enable debug output</span>
                    </label>
                    <div class="grid grid-cols-2 gap-4 mt-2">
                        <div>
                            <label class="text-sm font-medium">LED fast delay (ms)</label>
                            <input type="number" value.bind="ledFast" class="mt-1 w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                            <label class="text-sm font-medium">LED slow delay (ms)</label>
                            <input type="number" value.bind="ledSlow" class="mt-1 w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                            <label class="text-sm font-medium">Sanity steps</label>
                            <input type="number" value.bind="sanitySteps" placeholder="10000"
                                class="mt-1 w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                            <label class="text-sm font-medium">Home sensitivity</label>
                            <input type="number" value.bind="homeSensitivity" placeholder="300"
                                class="mt-1 w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                            <label class="text-sm font-medium">Full step count</label>
                            <input type="number" value.bind="fullStepCount" placeholder="4096"
                                class="mt-1 w-full px-3 py-2 border rounded" />
                        </div>
                        <div>
                            <label class="text-sm font-medium">Debounce delay (ms)</label>
                            <input type="number" value.bind="debounceDelay" placeholder="10"
                                class="mt-1 w-full px-3 py-2 border rounded" />
                        </div>
                    </div>
                </div>

                <label class="flex items-center gap-3 cursor-pointer border rounded-lg p-4">
                    <input type="checkbox" checked.bind="enableAdvancedConfig" class="w-4 h-4 text-blue-600 rounded" />
                    <span>Edit configuration files before compiling</span>
                </label>
            </div>

            <div if.bind="error" class="bg-red-50 border border-red-200 rounded-lg p-4">
                <p class="text-red-700">${error}</p>
            </div>
        </div>

        <nav-bar au-slot="footer" back-action.bind="() => goBack()" next-action.bind="() => goNext()">
        </nav-bar>
    </app-layout>
</template>